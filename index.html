<!DOCTYPE html>
<html>
<head lang="ru">
    <base href="/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1 maximum-scale=1 user-scalable=no">
    <link rel="stylesheet" href="style/common.css">
</head>
<body>
<div class="width">

    <div class="block-date">
        <span id="date"></span>
        <a href="https://github.com/mrsuh/time-left"><img src="github-ico.png"></a>
    </div>

    <div class="block-video">
        <div class="video">
            <iframe src="https://embed-ssl.ted.com/talks/meg_jay_why_30_is_not_the_new_20.html" width="640" height="360"
                    frameborder="0" scrolling="no" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
        </div>
    </div>

    <div class="block-weeks">
        <div class="info">
            <div class="square full"></div>
            <div class="text"><span id="weeks_passed"></span> weeks passed</div>
            <div class="square empty"></div>
            <div class="text"><span id="weeks_left"></span> weeks left</div>
        </div>
        <div id="cell_weeks"></div>
    </div>

    <div class="block-days">
        <div class="info">
            <div class="square full"></div>
            <div class="text"><span id="days_passed"></span> days passed</div>
            <div class="square empty"></div>
            <div class="text"><span id="days_left"></span> days left</div>
        </div>
        <div id="cell_days"></div>
    </div>

</div>

</body>
<script>

    var block_video_video =document.querySelector('.block-video .video');
    var block_video =document.querySelector('.block-video');

    block_video_video.onmouseover = function () {
        block_video.className = 'block-video hover';
    };
    block_video_video.onmouseout = function () {
        block_video.className = 'block-video';
    };

    function checkTime(i) {
        if (i < 10) {
            i = "0" + i
        }
        return i;
    }

    var current_date_time = new Date();

    var time_start_of_year_msec = (new Date(current_date_time.getFullYear(), 0, 1)).getTime();
    var time_fin_of_year_msec = (new Date(current_date_time.getFullYear(), 11, 31)).getTime();

    var current_time_msec = current_date_time.getTime();

    var past_time_start_year_msec = current_time_msec - time_start_of_year_msec;
    var past_time_fin_year_msec = (time_fin_of_year_msec - time_start_of_year_msec) - past_time_start_year_msec;

    var msec_one_week = 604800000;
    var msec_one_day = 86400000;

    var days_passed = past_time_start_year_msec / msec_one_day;
    var days_left = past_time_fin_year_msec / msec_one_day;

    document.getElementById('days_passed').innerHTML = days_passed.toFixed(0);
    document.getElementById('days_left').innerHTML = days_left.toFixed(0);

    var weeks_passed = past_time_start_year_msec / msec_one_week;
    var weeks_left = past_time_fin_year_msec / msec_one_week;

    document.getElementById('weeks_passed').innerHTML = weeks_passed.toFixed(0);
    document.getElementById('weeks_left').innerHTML = weeks_left.toFixed(0);

    document.getElementById('date').innerHTML = checkTime(current_date_time.getDate()) + '.' + checkTime(current_date_time.getMonth() + 1) + '.' + current_date_time.getFullYear();

    var str = '';
    var weeks = parseInt(weeks_passed.toFixed(0)) + parseInt(weeks_left.toFixed(0));
    for (var i = 1; i <= weeks; i++) {
        str += '<div class="square empty"></div>';
    }
    document.getElementById('cell_weeks').innerHTML = str;

    str = '';
    var days = parseInt(days_passed.toFixed(0)) + parseInt(days_left.toFixed(0));
    for (var i = 1; i <= days; i++) {
        str += '<div class="square empty"></div>';
    }

    document.getElementById('cell_days').innerHTML = str;

    var setColor = function (item, time) {
        setTimeout(function () {
            item.className = 'square full';
        }, time)
    };

    var color = function () {
        var days_passed_int = days_passed.toFixed(0) - 1;
        var list = document.querySelectorAll("#cell_days .square");
        for (var i = 0; i < list.length && i < days_passed_int; i++) {
            setColor(list[i], i * 30);
        }
        var weeks_passed_int = weeks_passed.toFixed(0) - 1;
        var list = document.querySelectorAll("#cell_weeks .square");
        for (var i = 0; i < list.length && i < weeks_passed_int; i++) {
            setColor(list[i], i * 210);
        }
    };

    setTimeout('color()', 1000);

</script>
</html>
